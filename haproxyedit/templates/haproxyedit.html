{% extends "base.html" %}

{% load static %}

{% block mycss %}
<link rel="stylesheet" href="{% static "css/bootstrap-duallistbox.css" %}" />
{#    <style type="text/css">#}
{#        .table th, .table td {#}
{#text-align: center;#}
{#vertical-align: middle!important;#}
{#}#}
{#    </style>#}
{% endblock %}

{% block mycontent %}
<h1 class="header">Haproxy全局配置</h1>
<div class="space-18"></div>
<div class="row">
    <div class="col-lg-12">
        <div class="tabbable">
            <ul class="nav nav-tabs" id="myTab">
                <li class="active">
                    <a data-toggle="tab" href="#HaproxyGroup" aria-expanded="true">
                        Haproxy全局组
                    </a>
                </li>

                <li class="">
                    <a data-toggle="tab" href="#HaproxyServers" aria-expanded="false">
                        Haproxy服务器
                    </a>
                </li>

                <li class="">
                    <a data-toggle="tab" href="#ACLRule" aria-expanded="false">
                        ACL全局规则
                    </a>
                </li>

                <li class="">
                    <a data-toggle="tab" href="#WebBackendCluster" aria-expanded="false">
                        后端集群全局规则
                    </a>
                </li>
            </ul>

            <div class="tab-content">
                <div id="HaproxyGroup" class="tab-pane fade active in">
                    <div class="row">
                        <div class="col-lg-12">
                            <form method="post" action="">
                            {% csrf_token %}
                            <input type="hidden" name="createansiblefile" value="createansiblefile" />
                            <button type="submit" class="btn {% if WaitForCreateAnsibleHostsFile %}  btn-danger {% else %} btn-primary {% endif %}">生成Ansible Host文件</button>
                            </form>
                        </div>
                    </div>
                    <div class="space-10"></div>
                    <div class="row">
                        <div class="col-lg-12">
                            <table class="table table-striped table-bordered table-hover">
                                <thead>
                                <tr>
                                    <th>组ID</th>
                                    <th>组名</th>
                                    <th>显示名</th>
                                    <th>组成员</th>
                                    <th>Haproxy配置文件路径</th>
                                    <th>备注</th>
                                    <th>
                                        操作&nbsp;&nbsp;&nbsp;
                                        <button class="btn btn-minier btn-success btn-white" id="addgroup" >
                                            <i class="ace-icon glyphicon glyphicon-plus "></i>
                                            新增
                                        </button>

                                        <div class="modal fade" id="AddGroupModal" tabindex="-1" role="dialog" aria-labelledby="AddGroupModalLabel" aria-hidden="true">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                                        <h4 class="modal-title center" id="AddGroupModalLabel">新增Haproxy组</h4>
                                                    </div>
                                                    <div class="modal-body">
                                                        <div class="row">
                                                            <div class="col-lg-12">
                                                                <form id="addhaproxygroup" class="form-horizontal" role="form">
                                                                {% csrf_token %}
                                                                    <div class="form-group">
                                                                        <label for="form-field-1" class="col-lg-3 control-label no-padding-right">
                                                                            组名:
                                                                        </label>
                                                                        <div class="col-lg-9">
                                                                            <input type="text" name="HG_Add_GroupName" class="input-xlarge" required="required" placeholder="只允许大小写字母数字与下划线"/>
                                                                        </div>
                                                                    </div>
                                                                    <div class="form-group">
                                                                        <label for="form-field-2" class="col-lg-3 control-label no-padding-right">
                                                                            显示名:
                                                                        </label>
                                                                        <div class="col-lg-9">
                                                                            <input type="text" name="HG_Add_GroupDisplayName" class="input-xlarge"/>
                                                                        </div>
                                                                    </div>
                                                                    <div class="form-group">
                                                                        <label for="form-field-3" class="col-lg-3 control-label no-padding-right">
                                                                            配置文件路径:
                                                                        </label>
                                                                        <div class="col-lg-9">
                                                                            <input type="text" name="HG_Add_ServerConfigFilePath" class="input-xlarge" placeholder="留空则使用默认路径"/>
                                                                        </div>
                                                                    </div>
                                                                    <div class="form-group">
                                                                        <label for="form-field-4" class="col-lg-3 control-label no-padding-right">
                                                                            备注:
                                                                        </label>
                                                                        <div class="col-lg-9">
                                                                            <input type="text" name="HG_Add_GroupComment" class="input-xlarge"/>
                                                                        </div>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                                        <button type="button" class="btn btn-primary" id="addhaproxygrouppost">新增</button>
                                                    </div>
                                                </div><!-- /.modal-content -->
                                            </div><!-- /.modal -->
                                        </div>

                                    </th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for group in HaproxyGroup %}
                                    <tr>
                                        <td>{{ group.GroupID }}</td>
                                        <td>{{ group.GroupName }}</td>
                                        <td>{{ group.GroupDisplayName }}</td>
                                        <td>
                                            {% ifequal group.haproxyserver_set.all|length 0 %}
                                                无
                                            {% else %}
                                                {% for server in group.haproxyserver_set.all %}
                                                        {% if forloop.first %}
                                                        {{ server.ServerIP }}
                                                    {% else %}
                                                        <br />{{ server.ServerIP }}
                                                    {% endif %}
                                                {% endfor %}
                                            {% endifequal %}
                                        </td>
                                        <td>{{ group.ServerConfigFilePath }}</td>
                                        <td>{{ group.GroupComment }}</td>
                                        <td>
                                            <div class="btn-group">

                                                <button class="btn btn-minier btn-info btn-white btn-bold" name="modifygroup">
                                                    <i class="ace-icon fa fa-pencil bigger-120"></i>
                                                    编辑
                                                </button>

                                                <button class="btn btn-minier btn-danger btn-white btn-bold" name="delgroup">
                                                    <i class="ace-icon fa fa-trash-o bigger-120"></i>
                                                    删除
                                                </button>

                                                <button class="btn btn-minier btn-primary btn-white btn-bold" name="groupmember">
                                                    <i class="ace-icon glyphicon glyphicon-user bigger-110"></i>
                                                    组成员
                                                </button>


                                            </div>
                                        </td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <!-- 模态框 -->
                    <div class="modal fade" id="ModifyGroupModal" tabindex="-1" role="dialog" aria-labelledby="ModifyGroupModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                    <h4 class="modal-title center" id="ModifyGroupModalLabel">编辑组信息</h4>
                                </div>
                                <div class="modal-body">
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <form id="modifyhaproxygroup" class="form-horizontal" role="form">
                                            {% csrf_token %}
                                                <div class="form-group">
                                                    <label for="form-field-1" class="col-lg-3 control-label no-padding-right">
                                                        组ID:
                                                    </label>
                                                    <div class="col-lg-9">
                                                        <input type="text" name="HG_Modify_GroupID" class="input-xlarge" required="required" readonly="true"/>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="form-field-1" class="col-lg-3 control-label no-padding-right">
                                                        组名:
                                                    </label>
                                                    <div class="col-lg-9">
                                                        <input type="text" name="HG_Modify_GroupName" class="input-xlarge" required="required" placeholder="只允许大小写字母数字与下划线"/>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="form-field-2" class="col-lg-3 control-label no-padding-right">
                                                        显示名:
                                                    </label>
                                                    <div class="col-lg-9">
                                                        <input type="text" name="HG_Modify_GroupDisplayName" class="input-xlarge"/>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="form-field-3" class="col-lg-3 control-label no-padding-right">
                                                        配置文件路径:
                                                    </label>
                                                    <div class="col-lg-9">
                                                        <input type="text" name="HG_Modify_ServerConfigFilePath" class="input-xlarge" placeholder="留空则使用默认路径"/>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="form-field-4" class="col-lg-3 control-label no-padding-right">
                                                        备注:
                                                    </label>
                                                    <div class="col-lg-9">
                                                        <input type="text" name="HG_Modify_GroupComment" class="input-xlarge"/>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                    <button type="button" class="btn btn-primary" id="modifyhaproxygrouppost">修改</button>
                                </div>
                            </div><!-- /.modal-content -->
                        </div><!-- /.modal -->
                    </div>
                    <div class="modal fade" id="DelGroupModal" tabindex="-1" role="dialog" aria-labelledby="delGroupModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                    <h4 class="modal-title center" id="delGroupModalLabel">删除转发组</h4>
                                </div>
                                <div class="modal-body">
                                    <div>
                                        <p class="red">
                                            请注意:
                                            下列转发组将被删除，此操作不可逆！
                                        </p>
                                        <p>
                                            <table class="table table-condensed">
                                                <thead>
                                                    <tr>
                                                        <th>组ID</th>
                                                        <th>组名</th>
                                                        <th>显示名</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                <tr id="delGroupTable">

                                                </tr></tbody>
                                            </table>
                                        </p>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                                    <button type="button" class="btn btn-danger" id="delhaproxygrouppost">删除</button>
                                </div>
                            </div><!-- /.modal-content -->
                        </div><!-- /.modal -->
                    </div>
                    <div class="modal fade" id="GroupMemberModal" tabindex="-1" role="dialog" aria-labelledby="GroupMemberModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                    <h4 class="modal-title center" id="GroupMemberModalLabel">组成员编辑</h4>
                                </div>
                                <div class="modal-body">

                                    <div class="row">
                                        <div class='col-lg-12'>
                                            <form id="groupmemberform">{% csrf_token %}
                                                <input type='hidden' name='HG_Select_GroupID' id="HG_Select_GroupID"/>
                                                <select multiple='multiple' size='10' name='HG_Select_GroupMember' class='selectgroupmember' id="selectgroupmember">
                                                </select>
                                            </form>
                                        </div>
                                    </div>

                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                                    <button type="button" class="btn btn-primary" id="groupmemberpost">确定</button>
                                </div>
                            </div><!-- /.modal-content -->
                        </div><!-- /.modal -->
                    </div>
                    <!-- /模态框 -->
                </div>

                <div id="HaproxyServers" class="tab-pane fade">
                    <div class="row">
                        <div class="col-lg-12">
                            <table class="table table-striped table-bordered table-hover">
                                <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>IP地址</th>
                                    <th>备注</th>
                                    <th>
                                        操作&nbsp;&nbsp;&nbsp;
                                        <button class="btn btn-minier btn-success btn-white" id="addserver" >
                                            <i class="ace-icon glyphicon glyphicon-plus "></i>
                                            新增
                                        </button>
                                        <div class="modal fade" id="AddServerModal" tabindex="-1" role="dialog" aria-labelledby="AddServerModalLabel" aria-hidden="true">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                                        <h4 class="modal-title center" id="AddServerModalLabel">新增Haproxy转发服务器</h4>
                                                    </div>
                                                    <div class="modal-body">
                                                        <div class="row">
                                                            <div class="col-lg-12">
                                                                <form id="addhaproxyserver"  class="form-horizontal" role="form">
                                                                    {% csrf_token %}
                                                                    <div class="form-group">
                                                                        <label for="form-field-1" class="col-lg-3 control-label no-padding-right">
                                                                            IP地址：
                                                                        </label>
                                                                        <div class="col-lg-9">
                                                                            <input type="text" name="HS_Add_ServerIP" class="input-xlarge" />
                                                                        </div>
                                                                    </div>
                                                                    <div class="form-group">
                                                                        <label for="form-field-2" class="col-lg-3 control-label no-padding-right">
                                                                            备注:
                                                                        </label>
                                                                        <div class="col-lg-9">
                                                                            <input type="text" name="HS_Add_ServerComment" class="input-xlarge"/>
                                                                        </div>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                                        <button type="button" class="btn btn-primary" id="addhaproxyserverpost">提交</button>
                                                    </div>
                                                </div><!-- /.modal-content -->
                                            </div><!-- /.modal -->
                                        </div>
                                    </th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for server in HaproxyServer %}
                                    <tr>
                                        <td>{{ server.ServerID }}</td>
                                        <td>{{ server.ServerIP }}</td>
                                        <td>{{ server.ServerComment }}</td>
                                        <td>
                                            <div class="btn-group">

                                                <button class="btn btn-minier btn-info btn-white btn-bold" name="modifyserver">
                                                    <i class="ace-icon fa fa-pencil bigger-120"></i>
                                                    编辑
                                                </button>

                                                <button class="btn btn-minier btn-danger btn-white btn-bold" name="delserver">
                                                    <i class="ace-icon fa fa-trash-o bigger-120"></i>
                                                    删除
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <!-- 模态框 -->
                    <div class="modal fade" id="ModifyServerModal" tabindex="-1" role="dialog" aria-labelledby="ModifyServerModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                    <h4 class="modal-title center" id="ModifyServerModalLabel">编辑Haproxy转发服务器</h4>
                                </div>
                                <div class="modal-body">
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <form id="modifyhaproxyserver"  class="form-horizontal" role="form">
                                                {% csrf_token %}
                                                <div class="form-group">
                                                    <label for="form-field-0" class="col-lg-3 control-label no-padding-right">
                                                        ID：
                                                    </label>
                                                    <div class="col-lg-9">
                                                        <input type="text" name="HS_Modify_ServerID" class="input-xlarge" readonly="true"/>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="form-field-1" class="col-lg-3 control-label no-padding-right">
                                                        IP地址：
                                                    </label>
                                                    <div class="col-lg-9">
                                                        <input type="text" name="HS_Modify_ServerIP" class="input-xlarge" />
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="form-field-2" class="col-lg-3 control-label no-padding-right">
                                                        备注:
                                                    </label>
                                                    <div class="col-lg-9">
                                                        <input type="text" name="HS_Modify_ServerComment" class="input-xlarge"/>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                    <button type="button" class="btn btn-primary" id="modifyhaproxyserverpost">提交</button>
                                </div>
                            </div><!-- /.modal-content -->
                        </div><!-- /.modal -->
                    </div>
                    <div class="modal fade" id="DelServerModal" tabindex="-1" role="dialog" aria-labelledby="delServerModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                    <h4 class="modal-title center" id="delServerModalLabel">删除Haproxy转发服务器</h4>
                                </div>
                                <div class="modal-body">
                                    <div>
                                        <p class="red">
                                            请注意:
                                            下列Haproxy服务器将被删除，此操作不可逆！
                                        </p>
                                        <p>
                                            <table class="table table-condensed">
                                                <thead>
                                                    <tr>
                                                        <th>ID</th>
                                                        <th>IP地址</th>
                                                        <th>备注</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                <tr id="delServerTable">

                                                </tr></tbody>
                                            </table>
                                        </p>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                                    <button type="button" class="btn btn-danger" id="delhaproxyserverpost">删除</button>
                                </div>
                            </div><!-- /.modal-content -->
                        </div><!-- /.modal -->
                    </div>
                    <!-- /模态框 -->
                </div>

                <div id="ACLRule" class="tab-pane fade"></div>
                <div id="WebBackendCluster" class="tab-pane fade"></div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block myscript %}
<script src="{% static "js/jquery.bootstrap-duallistbox.js" %}"></script>
<script src="{% static "js/dataTables/jquery.dataTables.js" %}"></script>
<script src="{% static "js/dataTables/jquery.dataTables.bootstrap.js" %}"></script>
<script src="{% static "js/bootstrap-tag.js" %}"></script>
<script>

    //激活组成员窗口
    $("button[name='groupmember']").click(function () {
        var demo2 = $('.selectgroupmember').bootstrapDualListbox({
            selectedListLabel: "组成员",
            nonSelectedListLabel: "可选组成员",
            infoTextEmpty: false,
            infoText: false,
            selectorMinimalHeight: 200,
            moveAllLabel: "选择所有",
            removeAllLabel: "移除所有",
            filterPlaceHolder: "过滤器"
        });
        groupid = getgrouptdinfo(this).groupid;
        $("#HG_Select_GroupID").attr("value", groupid);
        $.getJSON("#",{groupid : groupid},  function (json) {
            $(".selectgroupmember").empty();

            $.each(json.BindedServer, function (k, v) {
                $("#selectgroupmember").append("<option value='"+k+"' selected='selected'>"+v+"</option>");
                demo2.bootstrapDualListbox('refresh');
            });
            $.each(json.CanBindServer, function (k, v) {
                $(".selectgroupmember").append("<option value='"+k+"'>"+v+"</option>");
                demo2.bootstrapDualListbox('refresh');
            })
        })

        $('#GroupMemberModal').modal({
            keyboard: true
        })
    });

    //激活组增加窗口
    $("#addgroup").click(function () {
        $('#AddGroupModal').modal({
            keyboard: true
        })
    });

    //激活服务器增加窗口
    $("#addserver").click(function () {
        $('#AddServerModal').modal({
        keyboard: true
    })
    });

    //激活组编辑窗口
    $("button[name='modifygroup']").click(function () {
        haproxygroup = getgrouptdinfo(this);
        $("#modifyhaproxygroup").find("input[name='HG_Modify_GroupID']").attr("value", haproxygroup.groupid);
        $("#modifyhaproxygroup").find("input[name='HG_Modify_GroupName']").attr("value", haproxygroup.groupname);
        $("#modifyhaproxygroup").find("input[name='HG_Modify_GroupDisplayName']").attr("value", haproxygroup.groupdisplay);
        $("#modifyhaproxygroup").find("input[name='HG_Modify_ServerConfigFilePath']").attr("value", haproxygroup.serverconfigfilepath);
        $("#modifyhaproxygroup").find("input[name='HG_Modify_GroupComment']").attr("value", haproxygroup.groupcomment);
        $('#ModifyGroupModal').modal({
            keyboard: true
        })
    });

    //激活服务器编辑窗口
    $("button[name='modifyserver']").click(function () {
        haproxyserver = getservertdidipcomment(this);
        $("#modifyhaproxyserver").find("input[name='HS_Modify_ServerID']").attr("value", haproxyserver.serverid);
        $("#modifyhaproxyserver").find("input[name='HS_Modify_ServerIP']").attr("value", haproxyserver.serverip);
        $("#modifyhaproxyserver").find("input[name='HS_Modify_ServerComment']").attr("value", haproxyserver.servercomment);
        $('#ModifyServerModal').modal({
            keyboard: true
        })
    });

    //激活组删除窗口
    $("button[name='delgroup']").click(function () {
        haproxygroup = getgrouptdinfo($(this));
        $("#delGroupTable").empty();
        $("#delGroupTable").append("<td>"+haproxygroup.groupid+"</td><td>"+haproxygroup.groupname+"</td><td>"+haproxygroup.groupcomment+"</td>");
        $('#DelGroupModal').modal({
            keyboard: true
        })
    });

    //激活服务器删除窗口
    $("button[name='delserver']").click(function () {
        haproxyserver = getservertdidipcomment($(this));
        console.log(haproxyserver)
        $("#delServerTable").empty();
        $("#delServerTable").append("<td>"+haproxyserver.serverid+"</td><td>"+haproxyserver.serverip+"</td><td>"+haproxyserver.servercomment+"</td>");
        $('#DelServerModal').modal({
            keyboard: true
        })
    });

    //增加后端集群POST
        $("#addwebbackendclusterpost").click(function () {
        formadta = $("#addwebbackendclusterform").serializeArray();
            ajaxpost(formdata)
    });

    //组成员编辑操作POST
    $("#groupmemberpost").click(function () {

        formdata = $("#groupmemberform").serializeArray();
        formdata.GroupID = $("#selectgroupmember").attr("groupid")
        ajaxpost(formdata);
    })

    //组增加操作POST
    $("#addhaproxygrouppost").click(function () {
        formdata = $("#addhaproxygroup").serializeArray();
        ajaxpost(formdata);
    })

    //组编辑操作POST
    $("#modifyhaproxygrouppost").click(function () {
        formdata = $("#modifyhaproxygroup").serializeArray();
        ajaxpost(formdata);
    })

    //组删除操作POST
    $("#delhaproxygrouppost").click(function () {
        delgroupobj = new Object();
        delgroupobj.HG_Del_GroupID = $("#delGroupTable td").first().text();
        csrftoken = $("{% csrf_token %}").attr("value");
        delgroupobj.csrfmiddlewaretoken = csrftoken;
        ajaxpost(delgroupobj);
    })

    //服务器增加操作POST
    $("#addhaproxyserverpost").click(function () {
        formdata = $("#addhaproxyserver").serializeArray();
        ajaxpost(formdata);
    })

    //服务器编辑操作POST
    $("#modifyhaproxyserverpost").click(function () {
        formdata = $("#modifyhaproxyserver").serializeArray();
        ajaxpost(formdata);
    })

    //服务器删除操作POST
    $("#delhaproxyserverpost").click(function () {
        delserverobj = new Object();
        delserverobj.HS_Del_ServerID = $("#delServerTable td").first().text();
        csrftoken = $("{% csrf_token %}").attr("value");
        delserverobj.csrfmiddlewaretoken = csrftoken;
        ajaxpost(delserverobj);
    })

</script>
<script>
    function ajaxpost(formdata) {
        $.ajax({
                    type: "POST",
                    url: "#",
                    data: formdata,
                    dataType: "json",
                    success: function (data) {
                        if(data.state == 'success')
                        {window.location = '/haproxyedit/';}else {alert(data.msg)};

                    },
                    error: function (err) {
                                        alert("服务器错误！提交失败");
        }
    });
    }
</script>
<script>
    function getservertdidipcomment(obj) {
        var haproxyserver = new Object();
        haproxyserver.servercomment = $(obj).parent().parent().prev().text();
        haproxyserver.serverip = $(obj).parent().parent().prev().prev().text();
        haproxyserver.serverid = $(obj).parent().parent().prev().prev().prev().text();
        return haproxyserver
    }

    function getgrouptdinfo(obj) {
        var haproxygroup = new Object();
        haproxygroup.groupcomment = $(obj).parent().parent().prev().text();
        haproxygroup.serverconfigfilepath = $(obj).parent().parent().prev().prev().text();
        haproxygroup.groupdisplay =$(obj).parent().parent().prev().prev().prev().prev().text();
        haproxygroup.groupname = $(obj).parent().parent().prev().prev().prev().prev().prev().text();
        haproxygroup.groupid = $(obj).parent().parent().prev().prev().prev().prev().prev().prev().text();
        return haproxygroup
    }
</script>

{% ifnotequal HaproxyGroup|length 0 %}

    <script>
        $(function () {
            var sidebarul = $("<ul>", {"class": "submenu"});
{#            sidebarul.append("<li><a href='/haproxyedit/ACLRule/'><i class='menu-icon fa fa-caret-right'></i>ACLRule</a></li>");#}
{#            sidebarul.append("<li><a href='/haproxyedit/WebBackendCluster/'><i class='menu-icon fa fa-caret-right'></i>WebBackendCluster</a></li>");#}
            {% for group in HaproxyGroup %}
            sidebarul.append("<li><a href='/haproxyedit/{{ group.GroupID }}/'><i class='menu-icon fa fa-caret-right'></i>{{ group.GroupDisplayName }}</a></li>");
            {% endfor %}
            $("#haproxyedit").append(sidebarul);
        })
    </script>

{% endifnotequal %}

    <script>

        $("a[href='#ACLRule']").click(function () {
            $.get("/haproxyedit/ACLRule/",function (result) {
                var reg = new RegExp('falsemsg');
                if(reg.test(result)){
                    var aa = JSON.parse(result);
                    alert(aa.falsemsg)
                }else{$("#ACLRule").html(result);}
            })
        });

        $("a[href='#WebBackendCluster']").click(function () {
            $.get("/haproxyedit/WebBackendCluster/",function (result) {
{#                var reg = new RegExp('falsemsg');#}
{#                if(reg.test(result)){#}
{#                    var aa = JSON.parse(result);#}
{#                    alert(aa.falsemsg)#}
                $("#WebBackendCluster").html(result);
{#                }else{$("#WebBackendCluster").html(result);}#}
            })
        });



    </script>

{% endblock %}